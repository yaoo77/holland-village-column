# プロンプトチューニングシステム

このファイルは、コラム生成の品質を向上させるための**プロンプトチューニング**の仕組みを定義します。

---

## 1. イテレーションの仕組み

### 1.1 基本ルール
- **サンプルAとBをそれぞれ最大10回イテレーション**
- **目標: 90点以上**
- **90点に到達した時点でイテレーション終了**
- **10回イテレーションしても90点に到達しない場合、反省文を書く**

### 1.2 イテレーションのフロー

```
1. サンプルA/Bを生成
2. 評価基準で採点（100点満点）
3. 90点以上？
   → YES: イテレーション終了、次のステップへ
   → NO: 4へ
4. イテレーション回数が10回未満？
   → YES: 5へ
   → NO: 反省文を書く、イテレーション終了
5. 採点結果を分析
6. 改善点を特定
7. サンプルA/Bを再生成（1に戻る）
```

---

## 2. 採点基準の詳細

### 2.1 評価基準（合計100点）

| 項目 | 配点 | 評価ポイント |
|------|------|--------------|
| 言語・方言 | 10点 | 標準語を使用しているか、関西弁を使っていないか |
| フォーマット | 15点 | タイトル、情報源、導入部、締め、ハッシュタグ、改行、文字数（700文字前後） |
| 口調 | 25点 | 河村様の特徴的な表現、絵文字、語尾のパターン |
| 文章構造 | 20点 | 導入部、説明、締めのパターン、改行のリズム |
| 思考パターン | 20点 | 二項対立、構造的な問題への深掘り、プロの視点 |
| 価値観 | 10点 | リベラルな価値観、投資哲学 |

### 2.2 採点時の注意事項

#### 言語・方言（10点）
- **関西弁を1つでも使った場合、0点**
- 標準語のみ使用で10点

#### フォーマット（15点）
- タイトル: 3点
- 情報源: 2点
- 導入部: 2点
- 締め: 2点
- ハッシュタグ: 1点
- 改行: 2点
- 文字数（700文字前後、±100文字）: 3点

#### 口調（25点）
- 特徴的な表現の使用: 10点
- 絵文字の適切な使用: 5点
- 語尾のパターン: 10点

#### 文章構造（20点）
- 導入部のパターン: 7点
- 説明のパターン: 7点
- 締めのパターン: 6点

#### 思考パターン（20点）
- 二項対立の使用: 7点
- 構造的な問題への深掘り: 7点
- プロの視点: 6点

#### 価値観（10点）
- リベラルな価値観の反映: 5点
- 投資哲学の反映: 5点

---

## 3. 反省文の書き方

### 3.1 反省文を書くタイミング
- **10回イテレーションしても90点に到達しなかった場合**

### 3.2 反省文の内容

反省文には以下の内容を含めてください：

#### 3.2.1 ミスの内容
- **何が間違っていたか**を具体的に記述
- **どの評価項目で減点されたか**を明記

#### 3.2.2 原因分析
- **なぜそのミスが発生したか**を分析
- **プロンプトのどの部分が不十分だったか**を特定

#### 3.2.3 対策
- **今後同じミスを繰り返さないための対策**を提案
- **プロンプトの改善案**を具体的に記述

### 3.3 反省文の保存先
- **GitHubリポジトリの`lessons_learned.md`に追記**
- 次回のスケジュール実行時に、この反省文が参照される

### 3.4 反省文のフォーマット

```markdown
## YYYY年MM月DD日: [ミスのタイトル]

### ミス内容
1. **[評価項目]で減点**
   - [具体的なミスの内容]
2. **[評価項目]で減点**
   - [具体的なミスの内容]

### 原因分析
- [原因1]
- [原因2]

### 対策
- [対策1]
- [対策2]

### プロンプト改善案
- [改善案1]
- [改善案2]
```

---

## 4. イテレーションの実装例

### 4.1 サンプルA生成のイテレーション

```python
# 疑似コード
iteration_count = 0
max_iterations = 10
target_score = 90

while iteration_count < max_iterations:
    # サンプルAを生成
    sample_A = generate_sample_A(news, kawamura_style_abstraction)
    
    # 評価
    score = evaluate(sample_A, evaluation_criteria)
    
    # 採点結果を記録
    log_score(iteration_count, score)
    
    # 90点以上？
    if score >= target_score:
        print(f"サンプルA: {score}点で合格！")
        break
    
    # イテレーション回数をインクリメント
    iteration_count += 1
    
    # 改善点を分析
    improvement_points = analyze_score(score)
    
    # 改善点をフィードバック
    print(f"イテレーション{iteration_count}: {score}点")
    print(f"改善点: {improvement_points}")

# 10回イテレーションしても90点に到達しなかった場合
if iteration_count == max_iterations and score < target_score:
    print(f"サンプルA: 10回イテレーションしても{score}点で不合格")
    write_reflection(sample_A, score, improvement_points)
```

---

## 5. 反省文の自動追記

### 5.1 反省文の追記方法

```bash
# GitHubリポジトリをクローン
cd /tmp/hvmc
git clone https://github.com/yaoo77/holland-village-column.git
cd holland-village-column

# 反省文を追記
cat >> lessons_learned.md << 'EOF'

## $(date +%Y年%m月%d日): [ミスのタイトル]

### ミス内容
[具体的なミスの内容]

### 原因分析
[原因]

### 対策
[対策]

### プロンプト改善案
[改善案]

EOF

# GitHubにプッシュ
git add lessons_learned.md
git commit -m "反省文を追記: [ミスのタイトル]"
git push origin master
```

### 5.2 反省文追記の自動化

スケジュール実行時に、90点に到達しなかった場合、自動的に反省文を追記します。

---

## 6. プロンプトチューニングの効果

### 6.1 継続的な改善
- **反省文を蓄積**することで、同じミスを繰り返さない
- **プロンプトの改善案**を実装することで、品質が向上

### 6.2 学習サイクル
```
生成 → 評価 → 反省 → 改善 → 生成 → ...
```

このサイクルを繰り返すことで、コラムの品質が継続的に向上します。

---

## 7. 重要な注意事項

### 7.1 イテレーションの目的
- **90点以上のコラムを生成すること**
- **同じミスを繰り返さないこと**

### 7.2 反省文の重要性
- **反省文は次回のスケジュール実行時に参照される**
- **反省文を書くことで、プロンプトが改善される**
- **これがプロンプトチューニングの本質**

### 7.3 イテレーションの限界
- **10回イテレーションしても90点に到達しない場合、反省文を書く**
- **無限ループを避けるため、最大10回に制限**

---

## 8. まとめ

プロンプトチューニングシステムは、以下の要素で構成されます：

1. **イテレーション**: 最大10回、目標90点以上
2. **評価**: 100点満点の評価基準で採点
3. **反省**: 90点に到達しない場合、反省文を書く
4. **改善**: 反省文をGitHubに追記し、次回実行時に参照
5. **学習**: 継続的な改善サイクル

このシステムにより、コラムの品質が継続的に向上します。
