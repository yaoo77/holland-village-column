# 文字数チェックの改善策

## 問題点

今回、配信したコラムが**835文字**で、評価基準の「600-800文字」を**35文字超過**していました。

自己評価では「文字数も約570文字で適切」と誤った記載をしており、実際の文字数を正確にカウントしていませんでした。

## 根本原因

1. **目視での文字数推定**: 実際にコマンドで文字数をカウントせず、目視で「約570文字」と推定した
2. **評価時の確認不足**: 自己評価の際に、実際の文字数を`wc`コマンド等で確認しなかった
3. **チェックリストの不在**: 配信前に必ず確認すべき項目のチェックリストがなかった

## 具体的な改善策

### 1. 文字数カウントの自動化

**コラム生成後、必ず以下のコマンドで文字数をカウントする**:

```bash
# ハッシュタグと空行を除いた本文の文字数をカウント
cat /path/to/column.md | grep -v '^#HVMC_Morningcolumn' | grep -v '^$' | tr -d '\n' | wc -m
```

**より正確なカウント方法**:

```bash
# 【今日の金融トピック】からハッシュタグの前までをカウント
sed -n '/【今日の金融トピック】/,/#HVMC_Morningcolumn/p' /path/to/column.md | grep -v '#HVMC_Morningcolumn' | tr -d '\n' | wc -m
```

### 2. 評価時の必須チェック項目

**自己評価ファイルに以下の項目を必ず記載**:

```markdown
## フォーマットチェック

- [ ] 【今日の金融トピック】がある
- [ ] ニュースタイトルがある
- [ ] 〜[情報源]がある
- [ ] ↑ 導入部がある
- [ ] #HVMC_Morningcolumn がある
- [ ] **文字数: XXX文字（600-800文字の範囲内）** ← 必ずコマンドで確認した実数を記載
- [ ] 絵文字が使用されている（X個）
- [ ] 適切な改行がある
```

### 3. 配信前の最終チェックスクリプト

**配信前に実行する検証スクリプトを作成**:

```bash
#!/bin/bash
# check_column.sh

COLUMN_FILE=$1

echo "=== コラム検証 ==="

# 文字数チェック
CHAR_COUNT=$(sed -n '/【今日の金融トピック】/,/#HVMC_Morningcolumn/p' "$COLUMN_FILE" | grep -v '#HVMC_Morningcolumn' | tr -d '\n' | wc -m)
echo "文字数: ${CHAR_COUNT}文字"

if [ $CHAR_COUNT -lt 600 ]; then
    echo "❌ 文字数不足（600文字未満）"
    exit 1
elif [ $CHAR_COUNT -gt 800 ]; then
    echo "❌ 文字数超過（800文字超）"
    exit 1
else
    echo "✅ 文字数OK（600-800文字）"
fi

# 必須要素チェック
grep -q "【今日の金融トピック】" "$COLUMN_FILE" && echo "✅ 【今日の金融トピック】あり" || echo "❌ 【今日の金融トピック】なし"
grep -q "〜" "$COLUMN_FILE" && echo "✅ 情報源あり" || echo "❌ 情報源なし"
grep -q "#HVMC_Morningcolumn" "$COLUMN_FILE" && echo "✅ ハッシュタグあり" || echo "❌ ハッシュタグなし"

# 絵文字チェック
EMOJI_COUNT=$(grep -o '[😀-🙏🌀-🗿🚀-🛿]' "$COLUMN_FILE" | wc -l)
echo "絵文字: ${EMOJI_COUNT}個"

echo "=== 検証完了 ==="
```

### 4. ワークフローの改善

**新しいワークフロー**:

1. コラム生成
2. **文字数カウント（コマンド実行）**
3. **600-800文字の範囲外の場合、即座に修正**
4. 自己評価（実測値を記載）
5. **配信前に検証スクリプト実行**
6. 配信

### 5. lessons_learned.mdへの追記

**今回の失敗を反省文に追記**:

```markdown
## 文字数チェックの失敗（2025年11月12日）

### 問題
- 配信したコラムが835文字で、評価基準の600-800文字を35文字超過
- 自己評価では「約570文字」と誤った推定をしていた

### 原因
- 目視での推定に頼り、実際にコマンドで文字数をカウントしなかった

### 改善策
- コラム生成後、必ず`wc`コマンドで文字数をカウント
- 自己評価に実測値を記載
- 配信前に検証スクリプトを実行
```

## 実装計画

次回のコラム生成時から、以下を実施します:

1. **check_column.sh**スクリプトを作成
2. コラム生成後、必ず文字数をコマンドでカウント
3. 600-800文字の範囲外の場合、配信前に修正
4. 自己評価に実測値を記載
5. 配信前に検証スクリプトを実行

これにより、文字数超過のミスを防ぎます。
